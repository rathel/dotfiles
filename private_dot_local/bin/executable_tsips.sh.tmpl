#!/bin/bash

TSIPS="$(tailscale status | awk '{print $1}')"
HOSTIP="$(tailscale status | grep -i $(hostnamectl hostname) | awk '{print $1}')"
#TERMINAL="kitty @ launch --type=tab"
TERMINAL="alacritty"
run_once=false

for i in $TSIPS; do
	case $i in
		{{ .tailscale.ip.deck }})
			$TERMINAL -e ssh deck@"$i" >/dev/null 2>&1 &
			continue
			;;
		{{ .tailscale.ip.phone }})
			$TERMINAL -e ssh -p8022 u0_505@"$i" >/dev/null 2>&1 &
			continue
			;;
		$HOSTIP)	
			echo "Skipping Tailscale IP: $i."
			continue
			;;
	esac

	notify-send -t 1000 "Connecting to $i."
	# ssh-copy-id rathel@$i
	# alacritty ssh rathel@$i &
	$TERMINAL -e ssh "$i" >/dev/null 2>&1 &
	sleep 1
	if ! $run_once; then
		niri msg action toggle-column-tabbed-display	
		run_once=true
	fi
	# kitty --detach kitten ssh rathel@$i &
	# wezterm ssh "$i" &
	sleep 1
	niri msg action focus-column-left
	niri msg action consume-window-into-column

done



# vim: filetype=bash
